<!DOCTYPE html>
<html>
<!-- trial session link: http://jatos.psy.unsw.edu.au:9000/publix/230/start?batchId=272&generalMultiple -->

<head>
  <title>You Choose!</title>
  <script src="jatos.js"></script>
  <script src="jspsych-6.1.0/jspsych.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-survey-html-form.js"></script>
  <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css">
  <style>
    .jspsych-content {
      max-width: 45em;
    }
  </style>
  </link>


</head>

<body></body>

<script>
  //declaring timeline
  var timeline = [];


  //////////////////////
  /* begin experiment */
  //////////////////////


  //generate a random subject ID with 6 characters
  var subject_id = jsPsych.randomization.randomID(6);

  // add the subject ID to experiment  making it a property
  jsPsych.data.addProperties({
    subject: subject_id
  });


  // ETHICS ETC

  // ******************* WELCOME AND INFORMED CONSENT******************
  var smallFontSize = '90%';
  var mWidth = '16px 80px';

  /* define welcome message trial */
  var welcome = {
    type: "html-keyboard-response",
    stimulus: "<b>Welcome to the experiment. Press any key to begin.</b><br><br>You are unable to complete this experiment on a mobile device. <br><br>Please ensure you are using a computer with a keyboard and mouse/trackpad before continuing.<br><br><br>"
  };

  timeline.push(welcome);

  var welcome_task_blurb = '<b>"You Choose!"</b> is a psychological study investigating the relationship between decision-making and people&apos;s approach to effort. To participate you will need to be using a computer (with keyboard and mouse/trackpad) and be in a quiet, distraction free space.';


  var welcome1 = {
    type: "html-button-response",
    stimulus: function() {
      return '<h1 style="text-align:center;">UNSW Sydney</h1>' +
        '    <p style="text-align:left;line-height:190%;margin:' + mWidth + ';"><br>Thank you for applying to participate in this study. ' + welcome_task_blurb + ' It involves the following steps:</p>' +
        '<ol style="text-align:left;line-height:190%;margin:' + mWidth + ';">' +
        '<li>  We ask for your informed consent. Please read the participant information statement and consent form closely on the next page. <br></li>' +
        '<li>  You will then be asked some questions about yourself.<br></li>' +
        '<li>  In the experiment you will engage in a series of choices between rewards that either do or do not require effort.<br></li>' +
        '<li>  Before starting the experiment, a detailed explanation of how to complete it will be given. <br></li>' +
        '<li>  In total it should take about 30 minutes to complete.<br></li>' +

        '</ol>' +
        '<p style="text-align:left;line-height:190%;margin:' + mWidth + ';">Please <u>do not</u> use the "back" ' +
        '   button on your browser or close the window until you reach the end of the experiment.' +
        '   This is very likely to break the experiment and may make it difficult for you to receive your SONA credit.' +
        '   However, if something does go wrong, please contact us! DO NOT PARTICIPATE TWICE! When you are ready to begin, click on' +
        '   the "START" button below.<br><br></p>'
    },
    choices: ['<p style="font-size:130%;line-height:0%;"><b>START!</b></p>']
  };
  timeline.push(welcome1);


  welcome.ethics = {};
  welcome.ethics.selection =
    'You are invited to take part in this research study. The research study aims to investigate the relationship between decision-making and people&apos;s approach to effort, as well as their real-world relevance. You have been invited to participate because you are studying PSYC1A or PSYC1B at UNSW.';
  welcome.ethics.description =
    `If you decide to take part in this research study, we will ask you to provide information about yourself, including your UNSW student number, your age and gender, as well as information regarding your current and previous course enrolment at UNSW. 
    You will answer some questions about your approach to schoolwork. You will be asked to type a number of words backwards and then will engage in a series of choices 
    between rewards that either do or do not require effort. At the end, you will be asked whether you provide consent to one final question. We don&apos;t expect this 
    research to cause any harm. However, you may skip any or all written questions if you wish.  Please let the researchers know if you need any assistance for any reason.`;

  var welcome2 = {
    type: "html-button-response",
    stimulus: '<p style="text-align:right;font-size:' + smallFontSize + ';margin:' + mWidth + ';margin-top:30px;"></p>' +
      '			<p style="text-align:center;"><b>THE UNIVERSITY OF NEW SOUTH WALES<br>' +
      '			PARTICIPANT INFORMATION STATEMENT</b><br><br><b>You Choose!</b><br></p>' +
      '			<p style="text-align:left;font-size:' + smallFontSize + ';margin:' + mWidth + ';"><b>What is the research study about?</b><br>' + welcome.ethics.selection + '<br><br>' +
      '       <b>Who is conducting this research?</b><br>' +
      '			The study is being carried out by the following researchers: Lara Guerreiro and Steven B. Most, UNSW Sydney School of Psychology<br><br>' +
      '			<b>Do I have to take part in this research study?</b><br>' +
      '			Participation in this research study is voluntary. If you do not want to take part, you do not have to. If you decide to take part and later change your mind, you are free to withdraw from the study at any stage.<br><br>' +
      '			<b>What does participation in this research require, and are there any risks involved?</b><br>' + welcome.ethics.description + '<br><br>' +
      '     <b>What are the possible benefits to participation?</b><br>' +
      '     We cannot promise that you will receive any benefits from this study, but we hope to use the findings from this study to better understand people&apos;s approaches to effort. <br><br>' +
      '			<b>What will happen to information about me?</b><br>' +
      '			The information that you give us will be stored indefinitely after the project&apos;s completion. Although your UNSW Student ID will initially be linked with your data, it will be removed upon the study&apos;s completion, at which point your data will be deidentified, with your Student ID replaced with non-identifiable, unique participant identifier numbers. ' +
      ' 		Researchers at UNSW are requested to store their aggregated research data in the UNSW data repository, this is a system called ResData. Once the aggregated data are deposited into this repository, they will be retained in this system permanently, but in a format where your data will not be individually identifiable.' +
      '			Answers that you give during the study may be used for publication, and may be shared with other researchers. However this data will be de-identified meaning that it will not be linked to personal information about you.<br><br>' +
      '			<b>Total Participation Time and Recompense to Participants</b><br>' +
      '			In total, participation in this study will require about 30 minutes. You will receive 0.5 credit points as recompense for your participation. </b> <br><br>' +
      '			<b>How and when will I find out what the results of the research study are?</b><br>' +
      '			The research team intend to publish and/ report the results of the research study in a variety of ways. All information published will be done in a way that will not identify you. If you would like to receive a copy of the results you can let the research team know by e-mailing A/Prof Steven Most (s.most@unsw.edu.au). We will only use these details to send you the results of the research.</b> <br><br>' +
      '			<b>Inquiries</b><br>' +
      '			If you have any questions or concerns following your participation, A/Prof Steven Most (+61 2 9385 3827, email. s.most@unsw.edu.au) will be happy to address them. Complaints about the study may be directed to UNSW Human Research Ethics Coordinator, (phone +61 2 9385 6222, email humanethics@unsw.edu.au).<br><br> ' +
      '			Please read this consent form before proceeding (you can download the pdf <a href="consent_form.pdf" target="_blank">here</a>).<br>' +
      '			<br>' +
      '			<p style="text-align:center;"><b>PARTICIPANT CONSENT</b></p>' +
      '			<p style="text-align:left;font-size:' + smallFontSize + ';margin:' + mWidth +
      ';">By continuing, you are making a decision whether or not to participate.  Clicking the button below indicates that, having read the information provided on the participant information sheet and consent form, you have decided to participate.<br><br></p>',

    choices: ['<p style="font-size:130%;line-height:0%;"><b>I agree</b></p>'],
    prompt: '<p style="text-align:left;font-size:' + smallFontSize + ';margin:' + mWidth +
      ';"><br>To withdraw your consent, simply close the browser tab. Your data will be deleted from our records. Please let the research know of your choice to withdraw via email. Your decision not to participate or to withdraw from the study will not affect your relationship with UNSW Sydney.<br><br></p>'
  };

  timeline.push(welcome2);

  ////////////////////////
  /* TASK 1 TO COMPLETE */
  ////////////////////////

  // Add screen with personal details (zID, Age (in years), gender (drop down box))

  var user_information_form = {
    type: "survey-html-form",
    preamble: "Please provide the following information:",
    html: "<table style='margin: 0px auto;'>" +
            "<tr>" +
              "<td style='text-align:left; padding: 10px;'><b>Student ID (zID):</b></td>" +
              "<td style='text-align:right;'><input name='student_id' type='text' required></td>" +
            "</tr>" +
            "<tr>" +
              "<td style='text-align:left; padding: 10px;'><b>Age (in years):</b></td>" +
              "<td style='text-align:right'><input name='age' type='number' required></td>" +
            "</tr>" +
            "<tr>" +
              "<td style='text-align:left; padding: 10px;'><b>Gender:</b></td>" +
              "<td style='text-align:right'>" +
                "<select name='gender' required>" +
                  "<option value=''>Select Gender</option>" +
                  "<option value='male'>Male</option>" +
                  "<option value='female'>Female</option>" +
                  "<option value='non-binary'>Non-Binary</option>" +
                  "<option value='prefer-not-to-say'>Prefer Not to Say</option>" +
                "</select>" +
              "</td>" +
            "</tr>" +
          "</table>" +
          "<br><i>Please <b> double-check </b> your zID to make sure it is typed correct.</i><br><br>",
  };

  timeline.push(user_information_form);

  var user_course_form = {
    type: "survey-html-form",
    preamble: "<b>Please answer the following questions regarding your enrolment:</b>",
    html: "<table>" +
            "<tr>" +
              "<td style='text-align:left; padding: 10px;'>In Term 2, are you currently completing PSYC1A, PSYC1B or both courses simultaneously?</td>" +
              "<td style='text-align:right'>" +
                "<select name='q1' required>" +
                  "<option value=''>Select</option>" +
                  "<option value='PSYC1A'>PSYC1A</option>" +
                  "<option value='PSYC1B '>PSYC1B</option>" +
                  "<option value='BothCourses'>Both courses simultaneously</option>" +
                "</select>" +
              "</td>" +
            "</tr>" +
            "<tr>" +
              "<td style='text-align:left; padding: 10px;'>Did you complete PSYC1A in Term 1 2024?</td>" +
              "<td style='text-align:right'>" +
                "<select name='q2' required>" +
                  "<option value=''>Select</option>" +
                  "<option value='yes'>Yes</option>" +
                  "<option value='no'>No</option>" +
                "</select>" +
              "</td>" +
            "</tr>" +
          "</table>",
  };

  timeline.push(user_course_form);

  ////////////////////////
  /* TASK 2 TO COMPLETE */
  ////////////////////////

  // Add disclaimer screen for users to be in 'distraction free space' - red box & font big warning 

    // define page
  var warningPage = {
    type: "html-button-response",
    stimulus: "<div style=color:red;'><b>"
      + "<h1 style='text-align:center; width:100%;'>"
      + "Please make sure you are in a<br></br>distraction free space.<br></br><br></br>"
      + "This includes turning off your phone and any<br></br>other notifications.<br></br><br></br>"
      + "This task will take 30 minutes to complete."
      + "</h1>"
      + "</div><br></br>",
    choices: ['<p style="font-size:130%;line-height:0%;"><b>I am in a distraction free space.</b></p>']
  };

  // Please make sure you are in a distraction free space. This includes turning off your phone and any other notifications. This task will take 30 minutes to complete. 

  // Create a timeline to run the stimulus message
  timeline.push(warningPage);

  timeline.push({
    type: 'fullscreen',
    fullscreen_mode: true
  });

  //instructions for NCS
  var NCS_instructions = {
    type: "instructions",
    pages: [
      "Before the experiment begins, please fill out a short questionnaire."
    ],
    show_clickable_nav: true,
  };
  timeline.push(NCS_instructions);

  // Variable with the likert scale used
  var response_scale = [
    'Disagree',
    'Somewhat disagree',
    'Neither agree or disagree',
    'Somewhat agree',
    'Agree',
  ];

  // NCS trial
  var likert = {
    type: 'survey-likert',
    preamble: "For each of the statements below, please indicate to what extent the statement is characteristic of you.",
    questions: [{
        prompt: "<b>I put off projects until the last minute.</b>",
        labels: response_scale,
        required: true,
      },
      {
        prompt: "<b>I know I should work on schoolwork, but I just don&apos;t do it.</b>",
        labels: response_scale,
        required: true,
      },
      {
        prompt: "<b>I get distracted by other, more fun, things when I am supposed to work on schoolwork.</b>",
        labels: response_scale,
        required: true,
      },
      {
        prompt: "<b>When given an assignment, I usually put it away and forget about it until it is almost due.</b>",
        labels: response_scale,
        required: true,
      },
      {
        prompt: "<b>I frequently find myself putting important deadlines off.</b>",
        labels: response_scale,
        required: true,
      },
    ],
    scale_width: 1000,
    //modifying css of specific trial
    on_start: function() {
      document.getElementsByClassName("jspsych-content")[0].style.maxWidth = "95%";
    },
    //questions 3 4 5 7 8 9 12 16 17 are reverse scored. Also, scoring goes from -4 to +4 rather than 0 to +8 (-4 from every answer)
    on_finish: function(data) {
      //reversing CSS changes
      document.getElementsByClassName("jspsych-content")[0].style.maxWidth = "45em";

      // convert responses from JSON string to JS object
      var responses = JSON.parse(data.responses);


      //changing scoring to -4 to +4 instead of 0 to +8
      // Lara's scoring = -2 to +2 
      responses.Q0 = responses.Q0 - 2;
      responses.Q1 = responses.Q1 - 2;
      responses.Q2 = responses.Q2 - 2;
      responses.Q3 = responses.Q3 - 2;
      responses.Q4 = responses.Q4 - 2;


      //Need for cognition score
      let responses_array = Object.values(responses);
      let NCS_score = responses_array.reduce(
        (accumulator, currentValue) => accumulator + currentValue,
        0
      );

      //save the total score
      data.score = NCS_score

      // save the updated data
      data.responses = JSON.stringify(responses);
    }
  };

  timeline.push(likert);

  //instructions
  var typing_instructions = {
    type: "instructions",
    pages: [
      "This experiment will guide you through a series of questions that each ask you to choose between two rewards. One of the rewards will require you to do a certain task to receive it at the specified timepoint." +
      "<p>The task you will be performing to receive hypothetical rewards is a backwards typing task.</p>" +
      "First, please perform this backwards typing task to get a feel for how difficult it is. <br>",
    ],
    show_clickable_nav: true,
  };
  timeline.push(typing_instructions);



  //generating a word list that will be sampled in backwards_typing
  var words =
    "Mouth Feature Flash Harlot Humid Gutsy Grape Atmosphere Bludgeon Imprint Club Diamond Brick Anywhere Bawling Guns Hazard Deplorable Barbaric Flesh Bull Dangerous Numeric Cougar Headache Drifter Hatch Bring Federation Limitless Heist Collarbone Healthy Fictional Fin Delicatessen Amazingly Communion Become Accomplice Frequent Faithless Hideous Cryptic Impure Computation Elsewhere Carnival Adherence Juvenile"

  var word_array = words.split(" ");

  // declaring typing task
  var backwards_typing = {
    type: 'survey-text',
    preamble: '<p>Here is a list of <b>50 words</b>. Please type each of these words <b>backwards</b> (e.g. "heaven rat lamppost" gets typed as "nevaeh tar tsoppmal"). You will not be timed.</p>',
    questions: [{
      prompt: '<p style = "font-size : 15px;font-style:italic;">' + word_array.join(" ").toLowerCase() + '</p>',
      required: false,
      name: "NAME OF WORDARRAY",
      placeholder: "Please type all 50 words backwards here",
      rows: 20,
      columns: 80
    }]
  }
  timeline.push(backwards_typing);


  var failed_typing = {
    type: 'html-keyboard-response',
    stimulus: "Please make sure you type all 50 words backwards. Press any key to try again.",
  }

  var if_node = {
    timeline: [failed_typing, backwards_typing],
    conditional_function: function() {
      // get the data from the previous trial,
      // and check which key was pressed
      var data = jsPsych.data.get().last(1).values()[0];
      if (data.responses.length < 250) {
        return true;
      } else {
        return false;
      }
    }
  }
  timeline.push(if_node);

  //introducing the DST
  var DST_instructions = {
    type: "instructions",
    pages: [
      "Thank you." +
      "<br><br>The experiment will now begin and you will be asked a series of questions about whether you would like to type a number of words backwards for a given reward."  +
      "<br><br>Please choose as though every reward you choose is real and going to be given to you.<br>",
    ],
    show_clickable_nav: true,
  };
  timeline.push(DST_instructions);


  //declaring what the reward will be for the initial task
  var initial_SE_reward;
  var indifference_point = 0;

  //declaring variables for binary search algoirthm
  var SE_array = [];
  for (var i = 1; i <= 20; i++) {
    SE_array.push(i);
  }
  var first = 0;
  var last = SE_array.length - 1;

  //declaring randomized effort levels CONSIDER MAKING THESE TIMELINE variables
  //and then invoking them in discounting_skeleton with jsPsych.timelineVariables!!!
  var first_effortlevel = 50;
  var second_effortlevel = 75;
  var third_effortlevel = 25;
  var fourth_effortlevel = 100;


  //declaring variable which will track timepoint throughout the experiment
  var time_point = 0;




  //>_____________________FIRST TIME POINT (TIMEPOINT0__________________<//

  //*************FIRST EFFORT LEVEL********************

  function question_stimuli(time_point_variation) {
    return [
      //stimuli for first effort level
      {
        stimulus: function() {
          if (jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.get().last(1).values()[0].key_press) == 'l') {
            first = SE_array.indexOf(initial_SE_reward + 1);
            initial_SE_reward = SE_array[Math.floor((first + last) / 2)]; //finds the index of the new middle and locates it in SE_array, then assigns the value of that index to initial_SE_reward
            return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + `
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + first_effortlevel + ` words ` + time_point_variation + `</b>`;
            // return "Press 'A' to if you would you prefer to simply receive <b>$" + initial_SE_reward + `</b> ${time_point_variation}
            // <br><br>OR<br><br>
            // Press 'L' if you would prefer to type <b>` + first_effortlevel + ` words</b> backwards for <b>$20 </b> ${time_point_variation}.`;
          } else if (jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.get().last(1).values()[0].key_press) == 'a') {
            last = SE_array.indexOf(initial_SE_reward - 1);
            initial_SE_reward = SE_array[Math.floor((first + last) / 2)]; //finds the index of the new middle and locates it in SE_array, then assigns the value of that index to initial_SE_reward
            return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + `
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + first_effortlevel + ` words ` + time_point_variation + `</b>`;
          }
        },
        skeleton: initial_SE_reward,
        specific_effort_level: first_effortlevel
      },

      //stimuli for second effort level
      {
        stimulus: function() {
          if (jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.get().last(1).values()[0].key_press) == 'l') {
            first = SE_array.indexOf(initial_SE_reward + 1);
            initial_SE_reward = SE_array[Math.floor((first + last) / 2)]; //finds the index of the new middle and locates it in SE_array, then assigns the value of that index to initial_SE_reward
            return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + `
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + second_effortlevel + ` words ` + time_point_variation + `</b>`;
          } else if (jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.get().last(1).values()[0].key_press) == 'a') {
            last = SE_array.indexOf(initial_SE_reward - 1);
            initial_SE_reward = SE_array[Math.floor((first + last) / 2)]; //finds the index of the new middle and locates it in SE_array, then assigns the value of that index to initial_SE_reward
            return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + `
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + second_effortlevel + ` words ` + time_point_variation + `</b>`;
          }
        },
        skeleton: initial_SE_reward,
        specific_effort_level: second_effortlevel
      },

      //stimuli for third effort level
      {
        stimulus: function() {
          if (jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.get().last(1).values()[0].key_press) == 'l') {
            first = SE_array.indexOf(initial_SE_reward + 1);
            initial_SE_reward = SE_array[Math.floor((first + last) / 2)]; //finds the index of the new middle and locates it in SE_array, then assigns the value of that index to initial_SE_reward
            return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + `
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + third_effortlevel + ` words ` + time_point_variation + `</b>`;
          } else if (jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.get().last(1).values()[0].key_press) == 'a') {
            last = SE_array.indexOf(initial_SE_reward - 1);
            initial_SE_reward = SE_array[Math.floor((first + last) / 2)]; //finds the index of the new middle and locates it in SE_array, then assigns the value of that index to initial_SE_reward
            return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + `
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + third_effortlevel + ` words ` + time_point_variation + `</b>`;
          }
        },
        skeleton: initial_SE_reward,
        specific_effort_level: third_effortlevel
      },

      //stimuli for fourth effort level
      {
        stimulus: function() {
          if (jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.get().last(1).values()[0].key_press) == 'l') {
            first = SE_array.indexOf(initial_SE_reward + 1);
            initial_SE_reward = SE_array[Math.floor((first + last) / 2)]; //finds the index of the new middle and locates it in SE_array, then assigns the value of that index to initial_SE_reward
            return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + `
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + fourth_effortlevel + ` words ` + time_point_variation + `</b>`;
          } else if (jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.get().last(1).values()[0].key_press) == 'a') {
            last = SE_array.indexOf(initial_SE_reward - 1);
            initial_SE_reward = SE_array[Math.floor((first + last) / 2)]; //finds the index of the new middle and locates it in SE_array, then assigns the value of that index to initial_SE_reward
            return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + `
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + fourth_effortlevel + ` words ` + time_point_variation + `</b>`;
          }
        },
        skeleton: initial_SE_reward,
        specific_effort_level: fourth_effortlevel
      },

    ];
  }

  //declaring variables that will be used in loop functio nfor adjusted_immediate_discounting and in discounting_skeleton
  var SE_rewards_taken_at_effort_level = [];
  var LH_rewards_taken_at_effort_level = [];

  function discounting_skeleton(time_point_variation) {
    initial_SE_reward = jsPsych.randomization.sampleWithReplacement([7, 8, 9, 10, 11, 12], 1)[0];
    return {
      type: 'html-keyboard-response',
      post_trial_gap: 500,
      stimulus: function() {
        //setting first and last so that they're the same each time this timeline is iterated through
        return "Press 'A' or 'L' to choose which option you would prefer " + ` ${time_point_variation}:
            <br></br><b>A</b> - <b>$` + initial_SE_reward + `</b> for doing nothing ` + time_point_variation + ` 
            <br><br>OR<br><br>
            <b>L</b> - <b> $20</b> for typing <b>` + jsPsych.timelineVariable('specific_effort_level', true) + ` words ` + time_point_variation + `</b>`;
        // return "Press 'A' to if you would you prefer to simply receive <b>$" + initial_SE_reward + `</b> ${time_point_variation}
        //   <br><br>OR<br><br>
        //   Press 'L' if you would prefer to type <b>` + jsPsych.timelineVariable('specific_effort_level', true) + ` words </b> backwards for <b>$20</b> ${time_point_variation}.`;
      },
      choices: ['a', 'l'],
      data: {
        'SE_reward_offered': 37, //just creating the variable which on_finish will edit. Number is arbitrary
        'indifference_point': 37,
        'effort_level': function() {
          return jsPsych.timelineVariable('specific_effort_level', true)
        },
      },
      on_finish: function(data) {
        data.SE_reward_offered = initial_SE_reward;
        data.indifference_point = 0;
        data.effort_level = jsPsych.timelineVariable('specific_effort_level', true);
        SE_rewards_taken_at_effort_level = [initial_SE_reward]; // keep in mind these two variables are set regardless of what key is pressed (which is a lil buggy)
        LH_rewards_taken_at_effort_level = [initial_SE_reward];
        console.log(SE_rewards_taken_at_effort_level);
        console.log(LH_rewards_taken_at_effort_level);
      },
    };
  };


  var adjusted_immediate_discounting = {
    type: 'html-keyboard-response',
    stimulus: jsPsych.timelineVariable('stimulus'),
    choices: ['a', 'l'],
    post_trial_gap: 500,
    on_finish: function(data) {
      data.SE_reward_offered = initial_SE_reward;
      data.indifference_point = indifference_point;
      data.effort_level = jsPsych.timelineVariable('specific_effort_level', true);

      console.log(SE_rewards_taken_at_effort_level);
      console.log(LH_rewards_taken_at_effort_level);
      past_trial_data = jsPsych.data.get().filter({
        effort_level: jsPsych.timelineVariable('specific_effort_level', true),
        timepoint: time_point
      });
      SE_rewards_taken_at_effort_level = past_trial_data.last(past_trial_data.count()).filter({
        key_press: 65
      }).select('SE_reward_offered').values;
      LH_rewards_taken_at_effort_level = past_trial_data.last(past_trial_data.count()).filter({
        key_press: 76
      }).select('SE_reward_offered').values;
      console.log(SE_rewards_taken_at_effort_level);
      console.log(LH_rewards_taken_at_effort_level);
    },
  };


  var finding_indifference_point = {
    timeline: [adjusted_immediate_discounting],
    loop_function: function(data) {

      console.log(SE_rewards_taken_at_effort_level);
      console.log(LH_rewards_taken_at_effort_level);
      //if loop runs if their indifference_point is found
      //i.e. IF THEY PRESS 'A' TO A NUMBER ONE MORE THAN THE MAX LH REWARD THEY'VE ACCEPTED OR IF THEY PRESS 'L' TO A NUMBER ONE LESS THAN THE MIN SE THEY'VE ACCEPTED
      if ((
          (jsPsych.pluginAPI.convertKeyCharacterToKeyCode('a') === data.values()[0].key_press) && Math.max.apply(Math, LH_rewards_taken_at_effort_level) ===
          (data.values()[0].SE_reward_offered - 1)
        ) ||
        (jsPsych.pluginAPI.convertKeyCharacterToKeyCode('l') === data.values()[0].key_press) && Math.min.apply(Math, SE_rewards_taken_at_effort_level) ===
        (data.values()[0].SE_reward_offered + 1)
      ) {
        //INDIFFERENCE POINT SETTING
        data.values()[0].indifference_point = Math.min.apply(Math, SE_rewards_taken_at_effort_level);
        //RESETTING OF VARIABLES
        initial_SE_reward = jsPsych.randomization.sampleWithReplacement([7, 8, 9, 10, 11, 12], 1)[0]; // resets initial_SE_reward in preparation for the next effort level.
        data.SE_reward_offered = initial_SE_reward;
        past_trial_data = 0; //resetting past_trial_data
        SE_rewards_taken_at_effort_level = 0; //resetting SE_rewards_taken_at_effort_level
        SE_rewards_taken_at_effort_level = 0; //resetting LH_rewards_taken_at_effort_level
        first = 0;
        last = SE_array.length - 1;
        //ENDING LOOP
        return false;
      }
      //If their indiff point is lower than 1 then default to 0
      else if (jsPsych.pluginAPI.convertKeyCharacterToKeyCode('a') === data.values()[0].key_press && (data.values()[0].SE_reward_offered === 1)) {
        //SETTING INDIFFERENCE POINT
        data.values()[0].indifference_point = 1;
        //RESETTING OF VARIABLES
        initial_SE_reward = jsPsych.randomization.sampleWithReplacement([7, 8, 9, 10, 11, 12], 1)[0]; // resets initial_SE_reward in preparation for the next effort level.
        data.SE_reward_offered = initial_SE_reward;
        past_trial_data = 0; //resetting past_trial_data
        SE_rewards_taken_at_effort_level = 0; //resetting SE_rewards_taken_at_effort_level
        SE_rewards_taken_at_effort_level = 0; //resetting LH_rewards_taken_at_effort_level
        first = 0;
        last = SE_array.length - 1;
        //ENDING LOOP
        return false;
      }
      //If their indfiff point is higher than 20 then default to 20
      else if (jsPsych.pluginAPI.convertKeyCharacterToKeyCode('l') === data.values()[0].key_press && (data.values()[0].SE_reward_offered === 20)) {
        //SETTING INDIFFERENCE POINT
        data.values()[0].indifference_point = 20;
        //RESETTING OF VARIABLES
        initial_SE_reward = jsPsych.randomization.sampleWithReplacement([7, 8, 9, 10, 11, 12], 1)[0]; // resets initial_SE_reward in preparation for the next effort level.
        data.SE_reward_offered = initial_SE_reward;
        past_trial_data = 0; //resetting past_trial_data
        SE_rewards_taken_at_effort_level = 0; //resetting SE_rewards_taken_at_effort_level
        SE_rewards_taken_at_effort_level = 0; //resetting LH_rewards_taken_at_effort_level
        first = 0;
        last = SE_array.length - 1;
        //ENDING LOOP
        return false;
      }
      //else loop runs if they haven't reached their indifference point yet.
      else {
        indifference_point = 0;
        return true;
      }
    }
  }


  function thank_you(time_point_variation) {
    return {
      type: 'instructions',
      pages: [`In the next few questions, you'll be asked what you would do if you had to wait <b>${time_point_variation}</b> before exerting the effort and receiving the associated reward.`],
      show_clickable_nav: true,
    };

  };

  var break_trial = {
    type: 'instructions',
    pages: function() {
      if (jsPsych.data.get().last(1).values()[0].effort_level === fourth_effortlevel) {
        time_point = time_point + 1; //time point variable
        return ["Thank you. <br><br>Click next to continue."];
      } else {
        return ["Thank you for answering these questions about typing " + jsPsych.data.get().last(1).values()[0].effort_level +
          " words backwards.</b> <br><br>You will now be asked about what you would do if you had to type a different number of words backwards."
        ];
      }
    },
    show_clickable_nav: true,
  };


  //creating variables for timepoint0
  var timepoint0 = {
    timeline: [discounting_skeleton("<i><b>right now</b></i>"), finding_indifference_point, break_trial],
    timeline_variables: question_stimuli("<i><b>right now</b></i>"),
    data: {
      timepoint: 0
    },
  }
  timeline.push(timepoint0);
  timeline.push(thank_you("<b>one day</b>"))
  //>_______END OF FIRST TIME POINT (TIMEPOINT0________zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz___<//


  //creating variables for timepoint1
  var timepoint1 = {
    timeline: [discounting_skeleton("<i><b>one day from now</b></i>"), finding_indifference_point, break_trial],
    timeline_variables: question_stimuli("<i><b>one day from now</b></i>"),
    data: {
      timepoint: 1
    },
  }
  timeline.push(timepoint1);
  timeline.push(thank_you("<b>one month</b>"))

  //creating variables for timepoint2
  var timepoint2 = {
    timeline: [discounting_skeleton("<i><b>one month from now</b></i>"), finding_indifference_point, break_trial],
    timeline_variables: question_stimuli("<i><b>one month from now</b></i>"),
    data: {
      timepoint: 2
    },
  }
  timeline.push(timepoint2);


  //checking use of computer before running the timeline. If mob is used then replacce contents of timeline with using_mobile_device
  function detectMob() {
    return ((window.innerWidth <= 800) && (window.innerHeight <= 600));
  };

  var using_mobile_device = { 
    type: "instructions",
    pages: [
      '<p style="text-align:center;font-size:150%">You seem to be using a mobile device so you will not currently be able to complete this survey.<br><br>To complete this survey, please visit this website using a computer with a keyboard and mouse/trackpad.</p>'
    ]
  };

  if (detectMob() === true) {
    timeline = [using_mobile_device];
  };
     ////////////////////////
  /* TASK 3 TO COMPLETE */
  ////////////////////////

  // Final consent question
  // Thank you for completing this survey. The investigators of this study request permission to access your end-of-term grades for the PSYC 1A and 1B. This will be used to examine relationships between self-reported procrastination, effort related decisions in the lab task and grades. Once your grades have been collected and matched with data from this current study, your student ID numbers will be removed from the data and replaced with non-identifiable, unique participant identifier numbers. 
  // I agree to have the researchers of this experiment collect my end-of-term grades for the PSYC 1A and 1B course. I understand that I am allowed to withhold permission and that withholding my permission will not affect my relationship with UNSW in any way.
  // I grant permission for the researchers to access my PSYC 1A and 1B grades.       
   // yes AND no button and either answer pushes them to the next slide 

   var finalConsent= {
      type: 'html-button-response',
      stimulus: '<p style="text-align:center;"><b>THE UNIVERSITY OF NEW SOUTH WALES<br>' 
              + 'FINAL CONSENT STATEMENT</b><br></p>'
              + '<p style="text-align:left;line-height:190%;margin:' + mWidth + ';">'
              + 'Thank you for participating in this study! <br><br> The investigators of this study request permission to access your class grades for the PSYC 1A and/or 1B.'  
              + 'This will be used to examine relationships between self-reported procrastination, effort related decisions in the lab task, date of experiment participation, and ' 
              + 'grades. Only the academic staff member of this project will have access to information linking your student ID with your grades. <br><br>Once your grades have been collected and matched with data from this current study, your student '
              + 'ID numbers will be removed from the data and replaced with non-identifiable, unique participant identifier numbers. <br><br>'
              + '<b><i>I agree to have the researchers of this experiment collect my class grades for the PSYC 1A and/or 1B course. <br><br>'
              + 'I understand that I am allowed to withhold permission and that withholding my permission will not affect my relationship '
              + 'with UNSW in any way. <br><br>'
              + 'I grant permission for the researchers to access my PSYC 1A and/or 1B class grades.'
              + '</i></b></p>',
      choices: ['Yes', 'No'],
      prompt: "<br><b>Do you consent?</b><br>"
    };

  timeline.push(finalConsent);


////////////////////////
  /* TASK 4 TO COMPLETE */
  ////////////////////////

  // Debriefing
  // Thank you very much. The experiment is now complete. You may close this window. If you are interested in learning more about this study and its purpose please see below further information. 
   // 1.	Research questions: (BOLD TEXT)
   // Is there a correlation between an individual’s self-reported procrastination tendencies and performance in an effort discounting task, and do these measures predict academic performance in PSYC 1A and 1B? Effort discounting refers to a tendency for people to select the lower of two rewards if it entails less effort to receive it.
   // 2. How does this study extend on previous research on this topic? (BOLD TEXT)
   // Previous research (Johnson & Most, 2023) has demonstrated that people often engage in more effort discounting if the effort is imminent than when assigning the effort to their future selves. This may be considered an objective analogue of tendency to procrastinate effort. This study will extend on this research by investigating an additional characteristic, whether self-reported procrastination and effort discounting indeed correlate with each other. For those participants who grant permission, we will additionally test whether one or both measures predicts academic performance in PSYC 1A and 1B. 
   // 3.	Potential real-world implications: (BOLD TEXT)
   // Determining a correlation between self-reported procrastination and performance in effort discounting tasks has potential real-life implications in understanding the outcomes and consequences of procrastination. Procrastination is not unique to academic studies and can be experienced by everyone in their daily living. Therefore, by understanding the potential consequences of having higher traits of procrastination and whether it is correlated with people’s decision making and/or performance in academic studies may lead to the development of strategies that people can adopt to avoid procrastination if we know it is in their best interest. 
   // 4.	Briefly describe a potential issue or limitation of the study (BOLD TEXT)
   // A potential practical issue of this study is that participants may not provide consent for us to collect their grades. This will limit the effects we are able to observe, however if we are unable to collect this data, the study will still be valid in exploring the relationship between self-reported procrastination and effort discounting. A possible limitation of the study is also that it is to be conducted online with participants completing the experiment in their own time and space. This means there are limits to how controlled the study is and we cannot guarantee participants’ full focus and attention. However, the experiment will have clear instructions asking participants to be in a quiet, distraction free room and we will recruit a large sample size to ensure accurate average results.  
  // 5.	Briefly describe the study methodology (BOLD TEXT)
  // The design of this study combines within-subjects manipulations of the amount timing of hypothetical effort and between-subjects measures of self-reported procrastination and PSYC 1A and 1B course grades. Dependent variables include score in Academic Procrastination Scale -Short Form, choices on effort discounting task, and end-of-term PSYC 1A and 1B grades. In the effort discounting task, independent variables are the level of effort (i.e., number of words typed backwards) and temporal distance (i.e., whether the effort is imagined to be imminent or in the future).
  // 6.	Further readings (BOLD TEXT)
  // Johnson, S. T., & Most, S. B. (2023). Taking the path of least resistance now, but not later: Pushing cognitive effort into the future reduces effort discounting. Psychon Bull Rev, 30(3), 1115-1124. https://doi.org/10.3758/s13423-022-02198-7 

  var debriefing = {
    type: "html-button-response",
    stimulus: function() {
      return '<h1 style="text-align:center;">UNSW Sydney</h1>' +
        '    <p style="text-align:left;line-height:190%;margin:' + mWidth + ';"><br>Thank you very much. The experiment is now complete. You may close this window. If you are interested in learning more about this study and its purpose please see below further information.</p>' +
        '<ol style="text-align:left;line-height:190%;margin:' + mWidth + ';" type="1">' +
        '<li><b>  Research questions: </b><br></li>' +
          '<p style="text-align:left;line-height:190%;">' +
            'Is there a correlation between an individual&apos;s self-reported procrastination tendencies and ' 
            + 'performance in an effort discounting task, and do these measures predict academic performance in '
            + 'PSYC 1A and 1B? Effort discounting refers to a tendency for people to select the lower of two rewards '
            + 'if it entails less effort to receive it. </p>' +
        '<li><b>  How does this study extend on previous research on this topic? </b><br></li>' +
          '<p style="text-align:left;line-height:190%;">' +
            'Previous research (Johnson & Most, 2023) has demonstrated that people often engage in more effort discounting '
            + 'if the effort is imminent than when assigning the effort to their future selves. This may be considered an '
            + 'objective analogue of tendency to procrastinate effort. This study will extend on this research by investigating ' 
            + 'an additional characteristic, whether self-reported procrastination and effort discounting indeed correlate with each other. ' 
            + 'For those participants who grant permission, we will additionally test whether one or both measures predicts academic' 
            + 'performance in PSYC 1A and 1B.'
          + '</p>' +
        '<li><b>  Potential real-world implications: </b><br></li>' +
          '<p style="text-align:left;line-height:190%;">' +
            'Determining a correlation between self-reported procrastination and performance in effort discounting tasks has potential ' 
            + 'real-life implications in understanding the outcomes and consequences of procrastination. Procrastination is not unique to '
            + 'academic studies and can be experienced by everyone in their daily living. Therefore, by understanding the potential ' 
            + 'consequences of having higher traits of procrastination and whether it is correlated with people&apos;s decision making ' 
            + 'and/or performance in academic studies may lead to the development of strategies that people can adopt to avoid procrastination ' 
            + 'if we know it is in their best interest.'
            + '</p>' +
        '<li><b>  Briefly describe a potential issue or limitation of the study </b><br></li>' +
          '<p style="text-align:left;line-height:190%;">' +
            'A potential practical issue of this study is that participants may not provide consent for us to collect their grades. This will ' 
            + 'limit the effects we are able to observe, however if we are unable to collect this data, the study will still be valid in exploring ' 
            + 'the relationship between self-reported procrastination and effort discounting. A possible limitation of the study is also that it ' 
            + 'is to be conducted online with participants completing the experiment in their own time and space. '
            + 'This means there are limits to how controlled the study is and we cannot guarantee participants&apos; full focus and attention. ' 
            + 'However, the experiment will have clear instructions asking participants to be in a quiet, distraction free room and we will recruit ' 
            + 'a large sample size to ensure accurate average results. '
            + '</p>' +
        '<li><b>  Briefly describe the study methodology </b><br></li>' +
          '<p style="text-align:left;line-height:190%;">' +
            'The design of this study combines within-subjects manipulations of the amount timing of hypothetical effort and between-subjects measure ' 
            + 'of self-reported procrastination and PSYC 1A and 1B class grades. Dependent variables include score in Academic Procrastination Scale '
            + '-Short Form, choices on effort discounting task, and PSYC 1A and 1B class grades. In the effort discounting task, independent variables '
            + 'are the level of effort (i.e., number of words typed backwards) and temporal distance (i.e., whether the effort is imagined to be imminent or in the future).'
            + '</p>' +
        '<li><b>  Further readings </b><br></li>' +
          '<p style="text-align:left;line-height:190%;">' +
            'Johnson, S. T., & Most, S. B. (2023). Taking the path of least resistance now, but not later: Pushing cognitive effort into the future reduces effort discounting. ' 
            + 'Psychon Bull Rev, 30(3), 1115-1124. https://doi.org/10.3758/s13423-022-02198-7 ' +
        '</ol>'
    },
    choices: ['<p style="font-size:130%;line-height:0%;"><b>Finish</b></p>']
  };
  timeline.push(debriefing);





  //initialising experiment
  //set jatosVersion to false to run locally without JATOS, true when JATOS is understood and running
  var jatosVersion = true;
  if (jatosVersion === false) {
    //start the experiment without jatos wrapping
    jsPsych.init({
      timeline: timeline,
      show_progress_bar: true,
      on_finish: function() {
        jsPsych.data.get().ignore(['internal_node_id']).localSave('csv', '.myData.csv'); /* This is just to store it locally!! Don't do this over  the 			internet or it will store on their computer!*/
      }
    });
  } else {
    jatos.onLoad(function() {
      /* start the experiment with jatos wrapping AND set up the SONA talk back*/
      // ---------- subject info ----------
      sona_id = jatos.urlQueryParameters.pID; // jsPsych.data.getURLVariable("id");
      jsPsych.data.addProperties({
        sona_id: sona_id
      });
      var completion_url = "https://unsw-psy.sona-systems.com/webstudy_credit.aspx?experiment_id=1373&credit_token=9a2498f9a35248b582fc119f6729baa5&survey_code=" + sona_id;
      var finish_msg = 'All done! Please click <a href="' + completion_url + '">here</a> to be returned to Sona and receive your credit';
      jsPsych.init({
        timeline: timeline,
        show_progress_bar: true,
        on_finish: function() {
          var results = jsPsych.data.get().ignore(['internal_node_id']).csv();
          jatos.submitResultData(results);
          document.write(`<div id="endscreen" class="endscreen" style="width:1000px"><div class="endscreen" style="text-align:center; border:0px solid; padding:10px; font-size:140%; width:800px;"><p><br><br><br>
          ${finish_msg}</p></div></div>`)
        }
      });
    });
  };
</script>



</html>
